import streamlit as st
import pandas as pd
import plotly.express as px

# 파일 업로드 처리
uploaded_file = st.file_uploader("CSV 파일을 업로드하세요", type="csv")

if uploaded_file is not None:
    # CSV 파일 로드 (인코딩을 cp949로 설정)
    data_1 = pd.read_csv(uploaded_file, encoding='cp949')

    # 실제 컬럼명 확인
    st.write("파일의 컬럼명:", data_1.columns)
    st.write("컬럼 수:", len(data_1.columns))

    # 데이터 일부 확인
    st.write("파일의 일부 데이터:", data_1.head())

    # 필요한 컬럼만 선택
    data_1_filtered = data_1[['행정구역', 
                              '2025년04월_남_0~9세', '2025년04월_남_10~19세', '2025년04월_남_20~29세', 
                              '2025년04월_남_30~39세', '2025년04월_남_40~49세', '2025년04월_남_50~59세', 
                              '2025년04월_남_60~69세', '2025년04월_남_70~79세', '2025년04월_남_80~89세', 
                              '2025년04월_남_90~99세', '2025년04월_남_100세 이상',
                              '2025년04월_여_0~9세', '2025년04월_여_10~19세', '2025년04월_여_20~29세', 
                              '2025년04월_여_30~39세', '2025년04월_여_40~49세', '2025년04월_여_50~59세', 
                              '2025년04월_여_60~69세', '2025년04월_여_70~79세', '2025년04월_여_80~89세', 
                              '2025년04월_여_90~99세', '2025년04월_여_100세 이상']]

    # 숫자 데이터로 변환
    data_1_filtered = data_1_filtered.apply(pd.to_numeric, errors='coerce')

    # Plotly로 연령대별 남성, 여성 인구 비교 시각화
    fig = px.bar(data_1_filtered,
                 x='행정구역',
                 y=['2025년04월_남_0~9세', '2025년04월_남_10~19세', '2025년04월_남_20~29세', 
                     '2025년04월_남_30~39세', '2025년04월_남_40~49세', '2025년04월_남_50~59세', 
                     '2025년04월_남_60~69세', '2025년04월_남_70~79세', '2025년04월_남_80~89세', 
                     '2025년04월_남_90~99세', '2025년04월_남_100세 이상',
                     '2025년04월_여_0~9세', '2025년04월_여_10~19세', '2025년04월_여_20~29세', 
                     '2025년04월_여_30~39세', '2025년04월_여_40~49세', '2025년04월_여_50~59세', 
                     '2025년04월_여_60~69세', '2025년04월_여_70~79세', '2025년04월_여_80~89세', 
                     '2025년04월_여_90~99세', '2025년04월_여_100세 이상'],
                 title="연령대별 남성, 여성 인구 비교",
                 labels={'value': '인구수', 'variable': '연령대'},
                 barmode='stack')

    # 그래프 출력
    st.plotly_chart(fig)
