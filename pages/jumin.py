import streamlit as st
import pandas as pd
import plotly.express as px

# 업로드된 파일 경로
file_path = '/mnt/data/202504_202504_연령별인구현황_월간.csv'

# CSV 파일 로드 (cp949 인코딩 사용)
data_1 = pd.read_csv(file_path, encoding='cp949')

# 필요한 컬럼만 선택: 행정구역, 남성과 여성의 연령대별 인구
data_1_filtered = data_1[['행정구역', 
                          '2025년04월_남_0~9세', '2025년04월_남_10~19세', '2025년04월_남_20~29세', 
                          '2025년04월_남_30~39세', '2025년04월_남_40~49세', '2025년04월_남_50~59세', 
                          '2025년04월_남_60~69세', '2025년04월_남_70~79세', '2025년04월_남_80~89세', 
                          '2025년04월_남_90~99세', '2025년04월_남_100세 이상',
                          '2025년04월_여_0~9세', '2025년04월_여_10~19세', '2025년04월_여_20~29세', 
                          '2025년04월_여_30~39세', '2025년04월_여_40~49세', '2025년04월_여_50~59세', 
                          '2025년04월_여_60~69세', '2025년04월_여_70~79세', '2025년04월_여_80~89세', 
                          '2025년04월_여_90~99세', '2025년04월_여_100세 이상']]

# 데이터를 숫자로 변환
data_1_filtered = data_1_filtered.apply(pd.to_numeric, errors='coerce')

# 데이터 시각화: 각 연령대별 남성, 여성 인구 비교
fig = px.bar(data_1_filtered,
             x='행정구역',
             y=['2025년04월_남_0~9세', '2025년04월_남_10~19세', '2025년04월_남_20~29세', 
                 '2025년04월_남_30~39세', '2025년04월_남_40~49세', '2025년04월_남_50~59세', 
                 '2025년04월_남_60~69세', '2025년04월_남_70~79세', '2025년04월_남_80~89세', 
                 '2025년04월_남_90~99세', '2025년04월_남_100세 이상',
                 '2025년04월_여_0~9세', '2025년04월_여_10~19세', '2025년04월_여_20~29세', 
                 '2025년04월_여_30~39세', '2025년04월_여_40~49세', '2025년04월_여_50~59세', 
                 '2025년04월_여_60~69세', '2025년04월_여_70~79세', '2025년04월_여_80~89세', 
                 '2025년04월_여_90~99세', '2025년04월_여_100세 이상'],
             title="연령대별 남성, 여성 인구 비교",
             labels={'value': '인구수', 'variable': '연령대'},
             barmode='stack')

# 그래프 출력
st.plotly_chart(fig)
